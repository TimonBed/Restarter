; =============================================================================
; PlatformIO Project Configuration
; =============================================================================
;
; This file configures the build environment for the PC Restarter firmware.
;
; COMMON COMMANDS:
;   pio run                    Build the firmware
;   pio run -t upload          Upload firmware to ESP32
;   pio run -t uploadfs        Upload web UI files (LittleFS)
;   pio run -t erase           Erase all flash (factory reset)
;   pio device monitor         Open serial monitor
;
; FULL UPLOAD (firmware + web files):
;   pio run -t upload && pio run -t uploadfs
;
; If using a specific port (replace COM3 with your port):
;   pio run -t upload --upload-port COM3
;   pio run -t uploadfs --upload-port COM3
;
; =============================================================================

[env:esp32c3]
; -----------------------------------------------------------------------------
; Platform & Board
; -----------------------------------------------------------------------------
; Using the ESP32-C3 platform with Arduino framework
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino

; -----------------------------------------------------------------------------
; Serial Monitor
; -----------------------------------------------------------------------------
; Baud rate for debug output (must match Serial.begin() in code)
monitor_speed = 115200

; -----------------------------------------------------------------------------
; Filesystem
; -----------------------------------------------------------------------------
; Use LittleFS for storing web UI files
; Files in the "data/" folder are uploaded to the ESP32's flash
board_build.filesystem = littlefs
board_build.partitions = partitions_ota.csv

; -----------------------------------------------------------------------------
; Library Dependencies
; -----------------------------------------------------------------------------
; These libraries are automatically downloaded from the PlatformIO registry
lib_deps =
  ; Async web server for HTTP + WebSocket
  ESP32Async/ESPAsyncWebServer@3.9.5
  
  ; TCP library required by the async web server
  me-no-dev/AsyncTCP@3.3.2
  
  ; MQTT client for Home Assistant integration
  knolleary/PubSubClient@2.8.0
  
  ; JSON parsing and serialization
  bblanchon/ArduinoJson@7.4.2

; -----------------------------------------------------------------------------
; Build Flags
; -----------------------------------------------------------------------------
; Compiler options and defines
build_flags = 
  ; Allow some C++ flexibility (needed for some library compatibility)
  -fpermissive
  
  ; Enable USB CDC (serial over USB) on boot
  ; Required for ESP32-C3 boards to use Serial for debugging
  -DARDUINO_USB_CDC_ON_BOOT=1
  -DARDUINO_USB_MODE=1

; -----------------------------------------------------------------------------
; PRODUCTION SECURITY (uncomment for commercial release)
; -----------------------------------------------------------------------------
; OTA signing key generation (RSA-3072, keep private key offline):
;   espsecure.py generate_signing_key --version 2 --keylen 3072 secure_boot_signing_key.pem
;
; Enable flash encryption to protect firmware and NVS data:
; board_build.flash_mode = dio
; board_build.partitions = default_encrypted.csv
; build_flags = ${env.build_flags} -DCONFIG_SECURE_FLASH_ENC_ENABLED=1
; 
; Enable secure boot (prevents unauthorized firmware):
; board_build.secure = enable
; build_flags = ${env.build_flags} -DCONFIG_SECURE_BOOT_V2_ENABLED=1
; build_flags = ${env.build_flags} -DCONFIG_SECURE_BOOT_SIGNING_KEY=\"secure_boot_signing_key.pem\"
;
; WARNING: Secure Boot + Flash Encryption may burn irreversible eFuses.
;          Validate everything in development before enabling these flags.
;
; Disable JTAG debugging in production:
; build_flags = ... -DCONFIG_ESP32C3_DEBUG_OCDAWARE=0